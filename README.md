# Пример программы для использования `libmysyslog`

Программа демонстрирует использование библиотеки `libmysyslog` для записи логов. Она позволяет задать сообщение, уровень важности, драйвер, формат сообщения и путь к файлу журнала с помощью опций командной строки.

## Описание программы

Программа принимает параметры командной строки, проверяет их корректность и вызывает функцию `mysyslog` для записи сообщения в журнал.

### Поддерживаемые параметры командной строки

| Опция | Описание                            | Обязательность |
|-------|-------------------------------------|----------------|
| `-m`  | Сообщение для записи в журнал       | Обязательная   |
| `-l`  | Уровень важности сообщения (целое число) | Необязательная, по умолчанию `INFO` |
| `-d`  | Идентификатор драйвера (целое число)| Необязательная |
| `-f`  | Формат сообщения (целое число)      | Необязательная, по умолчанию текстовый формат |
| `-p`  | Путь к файлу журнала                | Обязательная   |

### Пример запуска программы

```sh
./mysyslog_program -m "Пример сообщения" -l 1 -d 0 -f 0 -p /var/log/myapp.log
```

### Проверка входных данных

Программа проверяет наличие обязательных параметров `-m` (сообщение) и `-p` (путь). Если они отсутствуют, выводится сообщение об ошибке и справка по использованию.

### Основные этапы работы

1. Разбор параметров командной строки с помощью `getopt`.
2. Проверка наличия обязательных параметров.
3. Вызов функции `mysyslog` для записи сообщения в журнал.
4. Обработка ошибок при записи в журнал.

### Пример кода

```c
#include <stdio.h>
#include <stdlib.h>
#include <getopt.h>
#include "libmysyslog.h"

static void print_usage(const char *program_name) {
    fprintf(stderr, "Использование: %s -m сообщение -l уровень -d драйвер -f формат -p путь\n", program_name);
}

int main(int argc, char *argv[]) {
    int opt;
    char *msg = NULL;
    int level = INFO;
    int driver = 0;
    int format = 0;
    char *path = NULL;

    while ((opt = getopt(argc, argv, "m:l:d:f:p:")) != -1) {
        switch (opt) {
        case 'm':
            msg = optarg;
            break;
        case 'l':
            level = atoi(optarg);
            break;
        case 'd':
            driver = atoi(optarg);
            break;
        case 'f':
            format = atoi(optarg);
            break;
        case 'p':
            path = optarg;
            break;
        default:
            print_usage(argv[0]);
            exit(EXIT_FAILURE);
        }
    }

    if (msg == NULL || path == NULL) {
        fprintf(stderr, "Ошибка: Сообщение (-m) и путь (-p) обязательны.\n");
        print_usage(argv[0]);
        exit(EXIT_FAILURE);
    }

    if (mysyslog(msg, level, driver, format, path) != 0) {
        fprintf(stderr, "Ошибка: Не удалось записать в журнал.\n");
        exit(EXIT_FAILURE);
    }

    return 0;
}
```

## Функция `mysyslog`

Функция `mysyslog` используется для записи сообщений в журнал. Её описание приведено ниже.

### Прототип функции

```c
int mysyslog(const char* msg, int level, int driver, int format, const char* path);
```

### Параметры функции

- `msg` (const char *): Сообщение для записи.
- `level` (int): Уровень важности сообщения. Возможные значения:
  - `DEBUG` (0): Отладочная информация.
  - `INFO` (1): Информационное сообщение.
  - `WARN` (2): Предупреждение.
  - `ERROR` (3): Ошибка.
  - `CRITICAL` (4): Критическая ошибка.
- `driver` (int): Идентификатор драйвера, от которого исходит сообщение.
- `format` (int): Формат записи:
  - `0`: Текстовый формат.
  - `1`: JSON формат.
- `path` (const char *): Путь к файлу журнала.

### Возвращаемое значение

- `0`: Успешная запись.
- `-1`: Ошибка (например, невозможность открыть файл).

## Формат лога

### Текстовый формат

```
<временная метка> <уровень> <драйвер> <сообщение>
```
Пример:
```
2024-12-22 15:10:00 INFO 1 Системное сообщение
```

### JSON формат

```json
{
    "timestamp": "2024-12-22 15:10:00",
    "log_level": "CRITICAL",
    "driver": 2,
    "message": "Критическая ошибка"
}
```


## Заключение

Программа демонстрирует базовое использование функции `mysyslog` для ведения журнала. Это полезный инструмент для разработки и отладки приложений.

